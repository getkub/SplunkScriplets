---
- name: "Splunk Insert SavedSearches"
  hosts: localhost
  gather_facts: no
  vars:
    - ss_name: "test_ss"
    - splunk_uri: "https://localhost"
    - splunk_user: "admin"
    - splunk_pass: "changedme"
    - ss_search: "index=_internal | stats count"
    - ss_cron: "* 6 * * *"
    - ss_app: "launcher"
  tasks:
    - name: "DELETE saved searches"
      uri:
        url: "{{splunk_uri}}:8089/servicesNS/nobody/{{ss_app}}/saved/searches/{{ss_name}}"
        method: DELETE
        user: "{{splunk_user}}"
        password: "{{splunk_pass}}"
        status_code: [200, 201,404]
        force_basic_auth: yes
        validate_certs: no
        body_format: form-urlencoded
        return_content: true


    - name: "CURL request to create SavedSearch"
      command: |
          /usr/bin/curl -u {{splunk_user}}:{{splunk_pass}} -o /dev/null -k {{splunk_uri}}:8089/servicesNS/nobody/{{ss_app}}/saved/searches
          -d name="{{ss_name}}"
          --data-urlencode description="{{ss_name}}_description"
          --data-urlencode search="{{ss_search}}"
          --data-urlencode disabled=false
          --data-urlencode is_scheduled=1
          --data-urlencode cron_schedule="{{ss_cron}}"
